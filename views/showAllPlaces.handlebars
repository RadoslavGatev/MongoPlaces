
<div class="map"></div>

<script>
    var map;
    function initMap() {
        map = new google.maps.Map($('.map')[0], {
            center: {lat: -34.397, lng: 150.644},
            zoom: 8
        });
    }

    $(function () {

        initMap();

        var places ={{{toJSON places}}};
        $.each(places, function (key, val) {
            var marker = new google.maps.Marker({
                position: {lat: val.location[1], lng: val.location[0]},
                map: map
            });

            marker["placeId"] = val._id;
            marker.addListener('click', function () {
                var placeId = this.placeId;
                $.get("/places/info", {placeId: placeId}, function (response) {
                    var infowindow = new google.maps.InfoWindow({
                        content: response
                    });

                    infowindow.open(map, marker);
                });

            });
        });
    });
</script>
