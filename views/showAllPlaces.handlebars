<style>
    .like-button:not(.active) {
        display: none;
    }
</style>

<div class="clearfix" style="margin-bottom: 5px;">
    <a href="/places/add" class="btn btn-info pull-right" role="button"><i class="fa fa-plus"></i>Add new place</a>
</div>


<div class="map"></div>

<script>
    var map;
    function initMap() {
        map = new google.maps.Map($('.map')[0], {
            center: {lat: -34.397, lng: 150.644},
            zoom: 8
        });
    }

    $(function () {

        initMap();

        var places ={{{toJSON places}}};
        $.each(places, function (key, val) {
            var marker = new google.maps.Marker({
                position: {lat: val.location[1], lng: val.location[0]},
                map: map
            });

            marker["placeId"] = val._id;
            marker.addListener('click', function () {
                var placeId = this.placeId;
                $.get("/places/info", {placeId: placeId}, function (response) {
                    var infowindow = new google.maps.InfoWindow({
                        content: response
                    });

                    infowindow.open(map, marker);
                });

            });
        });

        $("body").on("click", ".like-button", function (e) {
            e.preventDefault();
            var self = this;
            $.post(this.href, function () {
                $(self).removeClass("active");
                $(".like-button").not(self).addClass("active");
            });
        });
    });
</script>
